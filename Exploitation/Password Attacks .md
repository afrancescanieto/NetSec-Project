# Password Attacks 

Password representations are associated with hash keys such as, 

1. MD5 
2. SHA 
3. WHIRLPOOL 
4. RipeMD 

They are also are defined as a 'One-Way function'. 
The basics of a one-way hash value function is when each input sequence is assigned a hash value, which is what is used in the authorizations tag. So while it's easy to read the input in, the output is far harder to decypt into the original input sequence. They are also collision free, so no, difference sequences with the dame hash value is the lottery ticker of the hash world. 

Not to mention that data that is generated by the hash functions are **psuedorandom**. 

Therefore, for password attacks the most effective method is through *professional guessing.*

### Methods for Cracking Hashes 

1. Lookup Tables
    - Pre-computed hashes from a dictionary get stored with their correspponing password into a lookup table

2. Reverse Lookup tables 
    - Allows for an attacker to brute force or dictionary attack to many hashes at the same time w/o a pre-computed lookup table
    
3. Rainbow Tables
    - A time-memory techinque that make the lookup tables small, but sacrificing the cracking speed as a consequence
    
4. Hashing with Salt
    - Randomizing hashes by appending or prepending a random string 

## Offline Password Attacks 

When a pentester is attempting to recover one or more passwords from a password storage file, it's considered as offline password attacks. 

The files are usually in either, 
1. Security Acount Manager (SAM) on Windows 
2. /etc/shadow on Linux 

Offline password attacks usually  require that the attacker have root and admin privileges. The exception to this being the password hashes being pulled from the database using;

1. SQL Injection 
2. Unprotected flat text files on a web server
3. Other unprotected/badly protected sources

The interface attakers use is the same one the legitimate users use such as login web pages and SSH or FTP servers. 

##### Difference between Offline and Online? 

Online is noisy. It also potentially leaves only one entry per attempt in a log file, thus minimizing the speed and efficiency of attack. 

For Offline attacks, after the credible storage mechanism is recovered there is not a single crumb on the target's system. Get in and Get out. 

### Offline Password Cracking Methods

##### Brute Force Attacks


1. uses all the possible combinations of a password in a given character set, depending of the given size. 
2. Due to the sheer size of the math of the possible combinations, it would take way too long to crack passwords with a brute force attack without specification. think around 210 years. 
3. attacker needs to have background information on the possible password pattern. 
    - basic assumptions include:
            - Password is eight characters long
            - First character is upper case
            - Next five characters are lower case
            - Next character is a number
            - Next character is a symbol
    - these assumptions cut the time to crack a password to 1.2 **days**

##### Dictionary Attack 

Allows attacker to use a list of common passwords and test a password hash against each word in that list. After the word is compared with the hash and it matches to word is most probable to be the original password.

**Resource**
https://crackstation.net/crackstation-wordlist-password-cracking-dictionary.htm

- Has a dictionary of 1.5 billion passwords 

##### Rule Based Attack 

Can apply permutations to the passwords to be guessed. Rules like "alphanumeric and eight characters long." 

##### Hybrid Attack 

Combining a limited Brute Force Attack and a dictionary attack, such as appeding all the combinations of 4 digit numbers to all the words in a dictionary

### hashcat

Keeping with the guess it till you make it theme, every attempt made is hashed and then compared to the actual hashed valued. The hashcat tool uses precomputed dictionaries, rainbow tables, and the brute force approach to find the most efficient way to crack the password. 

Some Features: 

1. It is multi-threaded

2. It is multi-hash and multi-OS based (Linux, Windows and OSX native binaries)

3. It is multi-Algorithm based (MD4, MD5, SHA1, DCC, NTLM, MySQL, etc.)

4. All attack-modes can be extended by specialized rules

5. It is possible to resume or limit sessions automatically. They recognize recovered hashes from the outfile at startup

6. It can load the salt list from the external file. This can be used as a brute-force attack variant

7. The number of threads can be configured and executed based on the lowest priority; 

8. It supports both hex-charset and hex-salt files

9. The 90+ Algorithm can be implemented with performance and optimization in mind.


##### Attack Mode Parameters

    0 = Straight

    1 = Combination

    2 = Toggle-Case

    3 = Brute-force

    4 = Permutation

    5 = Table-Lookup

    8 = Prince

##### Built-In charsets

   ?l = abcdefghijklmnopqrstuvwxyz

   ?u = ABCDEFGHIJKLMNOPQRSTUVWXYZ

   ?d = 0123456789

   ?s =  !"#$%&'()*+,-./:;<=>?@[\]^_`{|}~

   ?a = ?l?u?d?s

   ?b = 0x00 - 0xff

##### hashcat Dictionary Attack 

using a wordlist such as, 

**rockyou.txt WordList**:
https://www.scrapmaker.com/data/wordlists/dictionaries/rockyou.txt
hashcat -m 0 -a 0 -o cracked.txt target_hashes.txt /usr/share/wordlists/rockyou.txt
The command above is for the MD5 hash, by using the **-m 0** to designate

##### hashcat Combinator Attack 

Since people are ingrained to create password of two words mushed together, using the combinator Attack creates a new word list of every word combined with the other. 

First you create your combined wordlist 

This is a wordlist of 1000 most common words in english: https://gist.github.com/deekayen/4148741

This is a dictionary of txt files with the worst passwords:
https://wiki.skullsecurity.org/Passwords

/usr/share/hashcat-utils/combinator.bin 500-worst-passwords.txt 1-1000.txt > combined_wordlist.txt

# merge wordlists 
hashcat -m 0 bfield.hash combined_wordlist.txt

The command above runs the attack of the merged wordlist

##### hashcat Mask Attack 

Since most users use the format like "Bananas1", hashcat lets you configure it to search for all the passwords in that format.
hashcat -m 0 -a 3 -1 ?u -2 -?l?u?d -3 ?d  hash ?1?2?2?2?3?3?3

# using a format of "Mask101"
// **hash ?1?2?2?2?3?3?3** is the actual format of the hash 

##### hashcat Rule Based Attack 

Dubbed the "...most complicated of all the attack modes" by hellcat themselves, the rule based attack acts like a programming language for password attacking. It's functions allow the attacker to modify, cut, or extend words and has conditional operators.  

Reference for the expressions: https://hashcat.net/wiki/doku.php?id=rule_based_attack

### chntpw

This tool is used to edit the windows refistry

1. reset a users password
2. promote user to admin
chntpw [OPTIONS] <samfile> [systemfile] [securityfile] [otherreghive] # syntax 
### ophcrack-cli

It's a Microsoft Windows password cracker that uses rainbow tables as it's preferred method.

The rainbow tables can be found here: 
https://ophcrack.sourceforge.io/tables.php

When using ophcrack-cli make sure that pwdump6 and fgdump are installed to recieve compatible output.
ophcrack-cli -g -d path_to_rainbow_tables_dir/ -t path_to_rainbow_tables_dir/ -n 4 -f hashes.txt
**-d** - Path to rainbow tables
**-g** - do no run the GUI interface
**-t** - specify which table to use. 
**-n** - number of threads to use
**-f** - path to hashes file obtained from programs like fgdump or pwdump

### samdump2

This tool dumps the Window NT/2k/XP/Vista password hashes. It pulls them from the Security Account Manager (SAM) database. Since windows uses SysKey to encrypt their SAM database.  samdump2 pulls the key, decrypts and reveals the password hashes. 

samdump2 SYSTEM SAM > hashes.txt #syntax

### John the Ripper

Good ol' john is an open source password auditor and recovery tool. It supports hundreds of hash and cipher types. Essentially if you can think of one john probably supports it. 

First a copy of the password file needs to be made. 
For Windows: 

Dump the password hashes with samdump2

For Linux: 

umask 077
unshadow /etc/passwd /etc/shadow > mypasswd

**Make sure to make *mypasswd* available to non-root user accounts as well** 

Next let john do it's magic:
john mypasswd 

# this one runs on the default john file, but the script could be modified to use another wordlist file by assigning it to the variable:

**Wordlist=...**  to obtain a larger range. 
Wordlists: https://www.openwall.com/wordlists/

## Online Password Attacks 

When an attacker attempts to attack a computer sustem through an interface that is also presented to legitimate users, its an Online Password attack. Online password attacks support mainly dictionary attacks and brute force attacks. 


Advantages:

1. there is no need for special privileges to initiate the attack. 
2. wider variety of protocols that can be attacked
    - any one that accepts a login and password
3. can be initiated from anywhere in the world over the internet 


Disadvantages: 

1. It all depends on network spees and built-in delays making it slow
2. Noisy. Network services have log files that keep track of the login attempts
    - IDS/IPS and a web application firewall can be thanked for that
3. can be stopped after a certain amount of login attempts 

### hydra / hydra-gtk

It brute forces login information for services like, 

1. ftp
2. ssh
3. telnet
4. MS-SQL 
hydra -l <USER> -p <Password> <IP Address> http-post-form “<Login Page>:<Request Body>:<Error Message>”
You can get the information for the hydra syntax by entering the html through 'inspect element'. 

Steps: 

1. Go to headers area 
2. Go to Network tab and then make an attempt to login
3. After the fail, click on the POST method 
4. Click on "Edit and Resent" 
5. Grab the Hostname/IP , Login Page, Request body, and the Error message
6. Build the command with that. 
























