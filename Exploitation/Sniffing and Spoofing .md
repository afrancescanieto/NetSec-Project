# Sniffing and Spoofing 

##### What is Sniffing? 

Sniffing is the process of monitoring and capturing all data packets that are passing through a computer network. Administrators are usually in charge of using packet sniffers to analyze data traffic, but attackers can use the same tools to capture data packets in a network. 

The two types of sniffing attacks include; 

1. Active Sniffing 
    - Conducted on a switched network 
    - Attackers inject traffic into the LAN to enable sniffing
    
2. Passive Sniffing
    - Uses hubs instead of switches
    - Attacker connects to the LAN and are able to sniff the data traffic in the Network

## Network Sniffers 

### Wireshark 

Steps for using wireshark for network sniffing; 

1. Select the network interface and start
2. Open a web browser and type in desired URL 
3. Filter packets according to the desired protocol

### dnschef

This DNS proxy is used to provide fake DNS addresses and redirect traffic to other locations. 

Some features that set dnschef apart from other tools include; 

1. A more configurable system
2. Inclusive and Exclusive Domain Lists 
3. Support of multiple DNS record types 
4. The ability to match domains with wildcards
5. Proxying true responses for non-matching domains
6. Ability to define external configuration files 
7. Usage of IPv6 

**./dnschef.py --fakeip 127.0.0.1 -q**

The command above is configured to fake all replies with a fake ip. 

 **./dnschef.py --fakeip 127.0.0.1 --fakeipv6 ::1 -q**

The command above is the same as the previous except with a fake IPv6 

**Multiple Record Types of dnschef**: 

    | Record |  Description |Argument   | Example                  |
    +--------+--------------+-----------+--------------------------+
    |  A     | IPv4 address |--fakeip   | --fakeip 192.0.2.1       |
    |  AAAA  | IPv6 address |--fakeipv6 | --fakeipv6 2001:db8::1   |
    |  MX    | Mail server  |--fakemail | --fakemail mail.fake.com |
    |  CNAME | CNAME record |--fakealias| --fakealias www.fake.com |
    |  NS    | Name server  |--fakens   | --fakens ns.fake.com     |
    +--------+--------------+-----------+--------------------------+

**./dnschef.py --fakeip 127.0.0.1 --truedomains thesprawl.org,*.webfaction.com -q**

In the command above, the use of a wildcard (*). allows all the domains matching "webfaction.com" are reversed matched and resolved to their true values. 

A request for google.com won't be shown due to it not being specified in the wildcard domain.

 [A]
 
 *.google.com=192.0.2.1
 
   thesprawl.org=192.0.2.2
   
 *.wordpress.*=192.0.2.3  # create a dnschef.ini file with this information 

**./dnschef.py --file dnschef.ini -q** # dnschef then displays output that matches these entries. 

### netsniff-ng

This tool is used for, 

1. Analyzing Network Packets
2. Capturing pcap files 
3. Replay pcap files 
4. Redirection of Traffic between interfaces using a zero-copy packet

##### What is a zero-copy packet? 

To "Zero-copy", describes a computer operation where the CPU doesn't copy data from one memory area to another. 
What this means for netsniff-ng is that it's memory consumption is low, thus allowing for analysis of larger pcap files. 
To preform the zero-copy facility netsniff-ng uses two linux specific interfaces: 

1. RX_RING

2. TX_RING

These interfaces bypass the normal processing paths for packets in the networking stack. 

 **netsniff-ng --in eth0 --out dump.pcap -s -T 0xa1e2cb12 -b 0 tcp or udp**

The command above captures TCP or UDP traffic from interface eth0 into a pcap file. 

 **netsniff-ng --in wlan0 --rfraw --out dump.pcap --silent --bind-cpu 0**

The command above puts the wlan0 device into monitoring mode and captures all the raw 802.11 frames in to the dump.pcap file. 

 **netsniff-ng --in dump.pcap --mmap --out eth0 -k1000 --silent --bind-cpu 0**

The command above replays the pcap file, read through nmap I/O and sends the packets out via the eth0 device interface. 

  **netsniff-ng --in eth0 --out eth1 --silent --bind-cpu 0 --type host -r**

The command above redirects network traffic from the eth0 interface to the eth1 device for traffic that is supposedly pertained to the attacker's host, thus ignoring the broadcast, multicast and promiscuous traffic. The order of the traffic is randomized and no packet contents are printed to the terminal. 

  **netsniff-ng --in vlan0 --out dump.pcap -c -u \`id -u bob\` -g \`id -g bob\`** # omit the four backspaces 

1. Capture network traffic from the device vlan0 into a pcap file 
    - normal read and write I/O is specified
2. When RX_RING is set up for capture drop the privileges from root to the user and group "bob"

## Spoofing and MITM Attacks 

##### What is Spoofing ? 

Spoofing is when an attacker is presenting as a legiamate device to gain access to sensitive information. 

1. IP Spoofing 
    - Attackers presenting themselves with an IP address within a server's range, thus tricking the server into believing it is an authorized device 

2. DNS Spoofing 
    - Attackers intercept DNS requests and returns an address that leads to their own server instead of the intended server. 
    
3. HTTPS Spoofing 
    - Attackers create domains that look simliar to the targeted website 
    - Can register SSL certificates to make it look legitimate and secure 
    
4. SSL Stripping
    - Attackers intercepts the request between a victim and a server and creates an independent connection to the server through HTTPS protocol 
    - After the attacker recieves the response, it is then relayed to the victim in an unencrypted format forcing the target to continuously send unencrypted information to the attacker. 
    
    

### sslsplit 

SSLsplit is a SSL proxy tool that picks up SSL connections and fools the client by pretending to be the server they are connected to. 

To use sslsplit the target's default gateway needs to be changed, and the traffic of the victim needs to be redirected using arpspoof. 

**sysctl -w net.ipv4.ip_forward=1** # forwarding the IP to enable the system's router functionality 

 **./sslsplit -D -l connections.log -j /tmp/sslsplit/ -S logdir/ -k ca.key -c ca.crt ssl 0.0.0.0 8443 tcp 0.0.0.0 8080**

1. **-D**
     - starts SSLsplit in debug mode
     
2. **-l connections.log**
     - Outputs connection attempts in the log file 
     
3.  **-j /tmp/sslsplit/** and **-S logdir/**
    - The content of the connnections written in these two files 

4. **-k ca.key** 
    - private key 
5.  **-c ca.cer**
    - the pemfile
   
   ssl 0.0.0.0 8443 
   tcp 0.0.0.0 8080

### tcpreplay 

This suite replays and edits previously captured network traffic. 

 **tcpreplay -i eth7 -tK --loop 5000 --unique-ip smallFlows.pcap****

### macchanger

This tool is used to fake, change , or spoof a MAC Address from the attackers interface. 

**ifconfig <\interface\> down** # turn off interface

**sudo macchanger -r <\interface\>** # macchanger randomly generates new address 
