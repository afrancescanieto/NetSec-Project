# Vulnerablity Analysis 

After the infomation gathering stage of penetration testing, the data gathered from that phase needs to be analyzed for all the potential vulnerabilities. 

## Fuzzing Tools

#### Fuzzing? What is it? Why is it used? 

The process of sending badly formed data to a program and delibrately causing errors and failures in an application is called Fuzzing. It is usually focused on finding bugs ready for an attackers own code to be run. Its important to note that most fuzzers are 

1. protocol and file format dependent 
2. data-type dependant 

This is because an input channel bound to the target has to be connected in order for the Fuzzer to work. 
The main objective of a Fuzzer is tot reduce the number of unuseful tests in favor of speed. 

#### Attack Types 

Fuzzer attacks can include:

1. Numbers: signed/unsigned integers/float
2. Chars: urls, command-line inputs
3. Metadata: user-input text/ id3 tag
4. Binary Sequences 

 A good strategy to use when Fuzzing to make sure to inject values that are usually "known" as dangerous. 
 Values such as: 
 
 1. Zero, negative numbers, incredibly big numbers for integers
 2. Escaped,interpretable characters/ instructions for chars (SQL Requests, quotes/commands) 
 3. Random Binary 

For examples on each: https://owasp.org/www-project-web-security-testing-guide/v41/6-Appendix/C-Fuzz_Vectors

As previously stated, most of these attack vector values are within the I/O despite the fuzzed system. 

### SPIKE 

The SPIKE tool is a fuzzer customization software. It's nice to think of it as lego kit for fuzzing, the pieces are there but you gotta assemble and create your own infrastructure. Despite the fact that it is a C based fuzzer, you can use scripting to customize it as well as use a couple command line tools to interpret text files that contain the SPIKE primitives. 

Some main features of spike to focus on: 

1. Built-in strings for fuzzing that already guarantee effectiveness in producing a variety of errors.

2. The concept of "blocks" that calculates the size of sections inside the SPIKES generated code. these size values can then be inserted into the SPIKES codes themselves. This is helpful because when fuzzing protocols require a particular size value, SPIKE saves you from having to do the calculations. 

3. SPIKE supports a variety of data types used in different network protocols, so the copy paste ability can really come in handy. 

#### Primitive: generic_send_tcp and generic_send_udp

These two primitives are capable of sending data via their protocol to a specified IP address and port. 

**kali > ./generic_send_tcp 192.168. 1.101 80 somespikescript.spk somevariable somestring** # general skeleton of the command

**SKIPVAR amd SKIPSTR:** allow for movement to a particular variable or string 

## VoIP tools 

A Voice over IP network makes for a prime target for confidential information and is underestimated often. The protocol VoIP is responsible for allowing voice calls to be made through an internet connection instead of an analog phone line.  

#### Technical Enviornment used in a VoIP Network

It's important to note that VoIP networks mainly used protocols are:

1. SIP: for signaling, call routing and establishment. TCP connection is used between phones an a call manager
2. RTP: for the actual multimedia like voice and video transport over UDP. Uses Point to Point communication between phones. 
            **Where the voice packets are located**

Switches in a VoIP network typically have 2 VLANs on the same access port, data and voice. In an enviornment the protocols used to decide which packets go which VLAN are CDP, LLDP, and  802.1q. In each port configured with a voice VLAN, every 30 sec. the switch typically advertises tothe VLAN ID by sending its corresponding CDP,LLDP, or 802.1q packet. With a network sniffer it is easy to map out whether or not the network is using a voice VLAN configured on the port it's sniffing, as well as the VLAN ID if it is. 

For the attacker's terminal to be verified by the switch to be in the voice VLAN, it must send a specific sequence of the CDP,LLDP, or 802.1q packets as an enterance ticket. 

#### Attack Plan

1. Find the network post that is advertising the voice VLAN. 
2. Use a terminal to hop into the voice VLAN through the CDP packet entrance ticket 
3. Scan the voice VLAN IP range to find other phones for target selection
4. Select a target using a corporate phone directory.
5. Man-in-the-middle attack using ARP spoofing 
6. Record and Sniff network traffic 
7. Extract voice records from the traffic
8. Re-ARP target 

### voihopper Tool

The voihopper tool mimicks the behavior of an IP Phone to "hop" inside the voice VLAN. 

Steps voihopper takes in order to do this: 

1. Discovers the correct 12 bit voice VLAN ID that is used by the IP phones. 
2. A virtual VoIP ethernet interface is created on the operating system. 
3. Inserts a spoofed VLAN protocol header with the VVLAN ID to a DHCP request 
4. Once it's given an IP address in the VoIP VLAN subnet, all the ethernet frames within are tagged with the spoofed header. 

**voiphopper -i eth0 -z**
